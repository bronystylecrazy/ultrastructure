
[web.server]
host = "localhost"
port = 8080

[web.listen]
listener_network = "tcp"
shutdown_timeout = "10s"
disable_startup_message = false
enable_prefork = false
enable_print_routes = false

[web.tls]
cert_file = ""
cert_key_file = ""
cert_client_file = ""
tls_min_version = "1.2"

[web.fiber]
case_sensitive = false
strict_routing = false

[web.fiber.app]
server_header = ""
body_limit = "4MiB"
read_timeout = "10s"
write_timeout = "10s"
idle_timeout = "60s"
read_buffer_size = 4096
write_buffer_size = 4096
disable_keepalive = false
enable_ip_validation = true

[web.fiber.proxy]
trust_proxy = false
proxy_header = "X-Forwarded-For"

[web.fiber.proxy.trust_proxy_config]
proxies = []
link_local = false
loopback = false
private = false

[db]
driver = "postgres"
migrate = true
datasource = "postgres://user:pass@localhost:5432/app?sslmode=disable"

[db.log]
enabled = true
level = "warn"
slow_threshold = "100ms"
skip_caller_lookup = false
ignore_record_not_found_error = false
parameterized_queries = true

[db.trace]
enabled = true
db_name = ""
attributes = {}
without_query_variables = true
without_metrics = false
include_dry_run_spans = false

[token]
secret = "change-me"
issuer = "ultrastructure"
access_token_ttl = "15m"
refresh_token_ttl = "720h"

[apikey]
header_name = "Authorization"
header_scheme = "ApiKey"
hasher_mode = "argon2id" # "argon2id" | "hmac-sha256"
hmac_secret = ""          # required when hasher_mode = "hmac-sha256"
key_prefix = "usk"
key_id_length = 16
secret_length = 32
skew_allowance = "30s"
set_principal_ctx = true
set_principal_body = false
detailed_errors = false

[storage.s3]
region = "us-east-1"
endpoint = "https://s3.amazonaws.com"
access_key_id = "YOUR_ACCESS_KEY_ID"
secret_access_key = "YOUR_SECRET_ACCESS_KEY"
use_path_style = false
bucket = "your-bucket"
otel_enabled = false

[caching.redis]
in_memory = false
network = "tcp"
addr = "127.0.0.1:6379"
protocol = 3
username = ""
password = ""
db = 0
dial_timeout = "5s"
read_timeout = "3s"
write_timeout = "3s"
pool_size = 10
min_idle_conns = 0
max_idle_conns = 0
max_active_conns = 0
pool_timeout = "4s"
conn_max_idle_time = "30m"
conn_max_lifetime = "0s"

[realtime.broker]
mode = "embedded"
endpoint = ""
client_id = "" # auto-generated when empty
username = ""
password = ""
clean_session = false
connect_timeout = "10s"

[realtime.broker.tls]
ca_file = ""
cert_file = ""
key_file = ""
server_name = ""
insecure_skip_verify = false

[realtime.session_control]
provider = "" # "", "emqx"

[realtime.session_control.emqx]
endpoint = "" # ex: https://emqx.example.com:18083
username = ""
password = ""
bearer_token = ""
timeout = "5s"

[realtime.session_control.emqx.tls]
ca_file = ""
cert_file = ""
key_file = ""
server_name = ""
insecure_skip_verify = false

[realtime.tcp_listener]
id = "t1"
address = ":1883"

[realtime.websocket_listener]
id = "ws1"
path = "/realtime"

[realtime.topic_acl]
enabled = false
allowed_prefixes = ["/public/", "/tenant-a/"]

[otel]
enabled = true
service_name = "Ultrastructure"
log_level = "info"

[otel.resource_attributes]
"service.namespace" = "test"
"deployment.environment" = "dev"

[otel.otlp]
endpoint = "http://otel-collector:4317"
protocol = "grpc"
compression = "gzip"
timeout_ms = 10000
headers = { authorization = "Bearer xxx" }
insecure = false

[otel.otlp.tls]
ca_file = "/path/ca.pem"
cert_file = "/path/client.crt"
key_file = "/path/client.key"
server_name = "otel-collector"
insecure_skip_verify = false

[otel.traces]
exporter = "otlp"
sampler = "parentbased_traceidratio"
sampler_arg = 1

[otel.traces.otlp]
endpoint = "http://otel-collector:4318/v1/traces"
protocol = "http/protobuf"
compression = "gzip"
timeout_ms = 10000
headers = { authorization = "Bearer xxx" }
insecure = false

[otel.traces.otlp.tls]
ca_file = "/path/ca.pem"
cert_file = "/path/client.crt"
key_file = "/path/client.key"
server_name = "otel-collector"
insecure_skip_verify = false

[otel.logs]
exporter = "otlp"

[otel.logs.otlp]
endpoint = "http://otel-collector:4318/v1/logs"
protocol = "http/protobuf"
compression = "gzip"
timeout_ms = 10000
headers = { authorization = "Bearer xxx" }
insecure = false

[otel.logs.otlp.tls]
ca_file = "/path/ca.pem"
cert_file = "/path/client.crt"
key_file = "/path/client.key"
server_name = "otel-collector"
insecure_skip_verify = false

[otel.metrics]
exporter = "otlp"

[otel.metrics.tuning]
export_interval_ms = 10000
temporality = "cumulative"
histogram_aggregation = "explicit_bucket_histogram"

[otel.metrics.otlp]
endpoint = "http://otel-collector:4318/v1/metrics"
protocol = "http/protobuf"
compression = "gzip"
timeout_ms = 10000
headers = { authorization = "Bearer xxx" }
insecure = false

[otel.metrics.otlp.tls]
ca_file = "/path/ca.pem"
cert_file = "/path/client.crt"
key_file = "/path/client.key"
server_name = "otel-collector"
insecure_skip_verify = false
